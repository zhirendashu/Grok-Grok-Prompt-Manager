# Implementation Plan - 写真模式 (Portrait Mode)

我们将为随机骰子功能增加一个"写真模式"，用于生成具有固定风格框架但细节随机的高质量提示词。

## 用户需求

1. **入口**：在随机骰子 (Random Dice) 菜单中增加 "写真模式"。
2. **交互**：点击后弹出对话框，允许用户输入/修改"基础开头"（Prompt Prefix）。
3. **记忆**：系统自动记忆上次输入的开头，无需重复输入。
4. **生成**：`开头` + `随机库内容`。

## 核心任务

### 1. 修改 SidePanel UI

- 在 `dice-btn` 的点击事件中，向菜单数组 `opts` 添加新选项：
  - Label: `📸 写真模式 (Portrait)`
  - Action: `portrait`

### 2. 状态管理 (App 类)

- 引入 `portraitPrefix` 状态。
- 使用 `GM_getValue` / `GM_setValue` 实现持久化存储，确保刷新后依然记得用户的"开头"。

### 3. 创建配置弹窗 (App 类)

- 新增的方法: `showPortraitConfigModal(currentValue, onConfirm)`
- **UI 风格**: 保持 Glassmorphism 设计 (深色半透明背景, 模糊效果)。
- **内容**:
  - 标题: "设置写真开头 (Portrait Prefix)"
  - 输入框: 多行文本域 (`textarea`), 预填上次的内容。
  - 按钮: "确认生成 (Generate)" 和 "取消 (Cancel)"。

### 4. 实现生成逻辑

- 在 `handleRandomRequest` (或 `mixHandler`) 中处理 `portrait` 动作。
- **流程**:
    1. 调用 `showPortraitConfigModal` 获取前缀。
    2. 保存前缀到 Storage。
    3. 从当前激活的库中随机抽取 3-5 个提示词 (避开重复)。
    4. 组合: `[Prefix], [Random Prompt 1], [Random Prompt 2], ...`
    5. 发送内容到输入框。

## 验证计划

- [ ] 点击骰子按钮，能看到"写真模式"。
- [ ] 点击"写真模式"，弹出输入框，且包含默认或上次输入的内容。
- [ ] 修改开头并确认，检查生成的 Prompt 是否包含该开头。
- [ ] 再次点击，确认输入框中保留了上次修改的内容。
- [ ] 检查后续追加的随机词是否来自当前库。
