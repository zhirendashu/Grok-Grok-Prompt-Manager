# 📋 Grok Prompt Manager 更新计划可行性分析报告

**日期**: 2026-01-19
**版本**: v1.0
**作者**: Antigravity AI

---

## 📌 需求概览

### 1. 库选择面板可调整大小 ✅
**需求**: 像草稿台一样，可以自由拖动调整面板的宽度和高度

### 2. 集成推特插件功能 🔍
**需求**: 将 Twitter-X 女秘书插件集成到 Grok Prompt Manager 中，仅在 X/Twitter 主页启动

### 3. Chrome 插件迁移 🚀
**需求**: 评估将 Grok Prompt Manager 迁移为 Chrome 插件的可行性

---

## 🎯 需求 1: 库选择面板可调整大小

### ✅ 技术可行性
**难度**: ⭐⭐ (简单)

### 实现方案
参考 BottomPanel (草稿台) 的实现，添加：
1. **拖拽手柄** (Resize Handle)
2. **鼠标事件监听** (mousedown, mousemove, mouseup)
3. **尺寸限制** (最小/最大宽高)
4. **位置持久化** (localStorage)

### 代码示例
```javascript
// 添加调整大小手柄
const resizeHandle = document.createElement('div');
resizeHandle.className = 'gpm-resize-handle';
resizeHandle.style.cssText = `
    position: absolute;
    right: 0;
    bottom: 0;
    width: 12px;
    height: 12px;
    cursor: nwse-resize;
    background: rgba(29, 161, 242, 0.3);
    border-radius: 0 0 12px 0;
`;

// 拖拽调整大小逻辑
let isResizing = false;
let startX, startY, startWidth, startHeight;

resizeHandle.onmousedown = (e) => {
    isResizing = true;
    startX = e.clientX;
    startY = e.clientY;
    startWidth = panel.offsetWidth;
    startHeight = panel.offsetHeight;

    document.addEventListener('mousemove', onResize);
    document.addEventListener('mouseup', stopResize);
};

const onResize = (e) => {
    if (!isResizing) return;
    const newWidth = startWidth + (e.clientX - startX);
    const newHeight = startHeight + (e.clientY - startY);

    // 限制最小/最大尺寸
    panel.style.width = Math.max(280, Math.min(600, newWidth)) + 'px';
    panel.style.height = Math.max(400, Math.min(800, newHeight)) + 'px';
};
```

### 预计工作量
- **开发时间**: 30-45 分钟
- **测试时间**: 15 分钟
- **总计**: 约 1 小时

### 优点
- ✅ 用户体验提升
- ✅ 灵活性增强
- ✅ 实现简单

### 缺点
- ⚠️ 需要处理边界情况（屏幕边缘）
- ⚠️ 移动端适配需要额外考虑

---

## 🔍 需求 2: 集成推特插件功能

### 📊 插件功能分析

#### 核心功能模块
1. **自动化操作**
   - 自动点赞 (Auto Like)
   - 自动关注 (Auto Follow)
   - 自动转发 (Auto Retweet)
   - 频率限制 (Rate Limiting)

2. **媒体下载**
   - 高清图片下载 (4096x4096)
   - 视频下载 (最高码率)
   - GIF 下载
   - 批量下载

3. **界面优化**
   - 视频模式 (只显示视频推文)
   - 清爽界面 (隐藏 Spaces)
   - 只看原创 (过滤转发)

4. **高级搜索**
   - 自定义搜索条件
   - 书签搜索

### ✅ 技术可行性
**难度**: ⭐⭐⭐⭐ (中等偏难)

### 集成方案

#### 方案 A: 独立模块集成 (推荐)
```javascript
// 在 Grok Prompt Manager 中添加 Twitter 模块
class TwitterAssistant {
    constructor() {
        this.enabled = false;
        this.panel = null;
    }

    init() {
        // 检测是否在 Twitter/X
        if (!window.location.hostname.includes('twitter.com') &&
            !window.location.hostname.includes('x.com')) {
            return;
        }

        // 初始化推特助手
        this.createPanel();
        this.bindEvents();
    }

    createPanel() {
        // 创建独立的推特助手面板
        // 复用推特插件的 UI 代码
    }
}

// 在主脚本中
if (window.location.hostname.includes('twitter.com') ||
    window.location.hostname.includes('x.com')) {
    const twitterAssistant = new TwitterAssistant();
    twitterAssistant.init();
}
```

#### 方案 B: 条件加载
```javascript
// @match        https://grok.com/*
// @match        https://twitter.com/*
// @match        https://x.com/*

// 根据域名加载不同模块
if (window.location.hostname === 'grok.com') {
    // 加载 Grok Prompt Manager
    initGrokPromptManager();
} else if (window.location.hostname.includes('twitter.com') ||
           window.location.hostname.includes('x.com')) {
    // 加载 Twitter Assistant
    initTwitterAssistant();
}
```

### 需要解决的问题

#### 1. 代码冲突
- **问题**: 两个脚本都使用全局变量和样式
- **解决**: 使用命名空间隔离
```javascript
const GPM = {
    // Grok Prompt Manager 代码
};

const TWX = {
    // Twitter Assistant 代码
};
```

#### 2. GM API 权限
- **问题**: 需要额外的 GM 权限
- **解决**: 在 UserScript 头部添加
```javascript
// @grant        GM_download
// @grant        GM_xmlhttpRequest
// @connect      pbs.twimg.com
// @connect      video.twimg.com
```

#### 3. 依赖库
- **问题**: 推特插件依赖 fflate 和 dayjs
- **解决**: 添加 @require
```javascript
// @require      https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.min.js
// @require      https://cdn.jsdelivr.net/npm/dayjs@1.11.13/dayjs.min.js
```

### 预计工作量
- **代码整合**: 2-3 小时
- **冲突解决**: 1-2 小时
- **测试调试**: 1-2 小时
- **总计**: 约 4-7 小时

### 优点
- ✅ 功能强大，提升用户体验
- ✅ 一个脚本管理多个平台
- ✅ 代码复用，维护方便

### 缺点
- ⚠️ 脚本体积增大 (从 ~400KB 增至 ~500KB)
- ⚠️ 增加复杂度
- ⚠️ 需要额外的权限
- ⚠️ 可能影响性能

### 建议
**推荐方案 A (独立模块)**，原因：
1. 代码隔离，互不影响
2. 按需加载，性能更好
3. 便于维护和调试

---

## 🚀 需求 3: Chrome 插件迁移

### 📊 技术对比

| 特性 | UserScript (油猴脚本) | Chrome Extension (浏览器插件) |
|------|---------------------|---------------------------|
| **安装方式** | 需要 Tampermonkey | 直接安装 |
| **权限控制** | GM API | Chrome API |
| **更新方式** | 自动更新 | Chrome Web Store |
| **跨浏览器** | ✅ 支持 | ⚠️ 需要适配 |
| **开发难度** | ⭐⭐ | ⭐⭐⭐⭐ |
| **用户基数** | 小众 | 大众 |
| **审核流程** | 无 | 严格 |

### ✅ 技术可行性
**难度**: ⭐⭐⭐⭐⭐ (困难)

### 迁移方案

#### 架构对比
```
UserScript 架构:
┌─────────────────┐
│  Tampermonkey   │
├─────────────────┤
│  GM API         │
├─────────────────┤
│  Your Script    │
└─────────────────┘

Chrome Extension 架构:
┌─────────────────────────┐
│  Manifest V3            │
├─────────────────────────┤
│  Background Service     │
│  Content Scripts        │
│  Popup / Options        │
├─────────────────────────┤
│  Chrome API             │
└─────────────────────────┘
```

#### 需要重写的部分

1. **Manifest 文件**
```json
{
  "manifest_version": 3,
  "name": "Grok Prompt Manager",
  "version": "5.0.0",
  "description": "AI 提示词管理工具",
  "permissions": [
    "storage",
    "activeTab",
    "scripting"
  ],
  "host_permissions": [
    "https://grok.com/*"
  ],
  "content_scripts": [
    {
      "matches": ["https://grok.com/*"],
      "js": ["content.js"],
      "css": ["styles.css"]
    }
  ],
  "background": {
    "service_worker": "background.js"
  },
  "action": {
    "default_popup": "popup.html",
    "default_icon": "icon.png"
  }
}
```

2. **GM API 替换**
```javascript
// UserScript
GM_setValue('key', value);
GM_getValue('key', default);

// Chrome Extension
chrome.storage.local.set({ key: value });
chrome.storage.local.get(['key'], (result) => {
    const value = result.key || default;
});
```

3. **文件结构**
```
grok-prompt-manager/
├── manifest.json
├── background.js       # 后台服务
├── content.js          # 内容脚本
├── popup.html          # 弹窗页面
├── popup.js
├── options.html        # 设置页面
├── options.js
├── styles.css
└── icons/
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

### 预计工作量
- **架构重构**: 8-12 小时
- **API 替换**: 4-6 小时
- **UI 适配**: 4-6 小时
- **测试调试**: 6-8 小时
- **文档编写**: 2-3 小时
- **审核准备**: 2-3 小时
- **总计**: 约 26-38 小时 (3-5 天)

### 优点
- ✅ **用户体验更好**: 无需安装 Tampermonkey
- ✅ **更广泛的用户基础**: Chrome Web Store 曝光
- ✅ **更强大的 API**: Chrome API 功能更丰富
- ✅ **更好的性能**: 原生支持，无中间层
- ✅ **更专业**: 独立应用，品牌形象提升

### 缺点
- ❌ **开发成本高**: 需要完全重写
- ❌ **审核严格**: Chrome Web Store 审核周期长 (1-2 周)
- ❌ **维护成本高**: 需要维护两个版本 (UserScript + Extension)
- ❌ **更新不便**: 需要通过 Chrome Web Store 更新
- ❌ **跨浏览器适配**: Firefox、Edge 需要单独适配
- ❌ **Manifest V3 限制**: 某些功能受限

### 关键挑战

#### 1. 数据存储
- **UserScript**: 使用 `GM_setValue` (无限制)
- **Chrome Extension**: 使用 `chrome.storage.local` (限制 5MB)
- **解决**: 使用 IndexedDB 存储大数据

#### 2. 跨域请求
- **UserScript**: `GM_xmlhttpRequest` (无限制)
- **Chrome Extension**: 需要在 `manifest.json` 中声明 `host_permissions`

#### 3. 动态注入
- **UserScript**: 直接操作 DOM
- **Chrome Extension**: 需要通过 `chrome.scripting.executeScript`

### 建议

#### 短期 (1-2 个月)
**保持 UserScript 版本**，原因：
1. 开发成本低
2. 更新灵活
3. 功能完整

#### 中期 (3-6 个月)
**开发 Chrome Extension 版本**，作为补充：
1. 扩大用户群
2. 提升品牌形象
3. 获取更多反馈

#### 长期 (6-12 个月)
**双版本并行维护**：
1. UserScript: 快速迭代，高级功能
2. Chrome Extension: 稳定版本，大众用户

---

## 📊 总结与建议

### 优先级排序

1. **🥇 高优先级**: 库选择面板可调整大小
   - 开发成本低
   - 用户体验提升明显
   - 立即可实现

2. **🥈 中优先级**: 集成推特插件
   - 功能强大
   - 用户需求明确
   - 开发成本适中

3. **🥉 低优先级**: Chrome 插件迁移
   - 开发成本高
   - 维护成本高
   - 可作为长期规划

### 实施建议

#### 第一阶段 (本周)
- ✅ 实现库选择面板可调整大小
- ✅ 修复当前已知 Bug

#### 第二阶段 (下周)
- 🔍 评估推特插件集成
- 🔍 设计集成方案
- 🔍 开始代码整合

#### 第三阶段 (下月)
- 🚀 调研 Chrome Extension 开发
- 🚀 准备技术方案
- 🚀 评估投入产出比

---

## 📝 附录

### 相关资源
- [Chrome Extension 官方文档](https://developer.chrome.com/docs/extensions/)
- [Manifest V3 迁移指南](https://developer.chrome.com/docs/extensions/mv3/intro/)
- [Tampermonkey API 文档](https://www.tampermonkey.net/documentation.php)

### 联系方式
如有疑问，请联系开发者：
- GitHub: @zhirendashu
- Twitter: @OnlyPeachFWD

---

**报告结束**
