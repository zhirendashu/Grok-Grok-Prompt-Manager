# ğŸ“‹ Twitter-X æ™ºèƒ½åŠ©æ‰‹ v3.0 - åŠŸèƒ½æ¸…å•ä¸ä¼˜åŒ–æ–¹æ¡ˆ

**æ—¥æœŸ**: 2026-01-19
**åŸºäº**: X.com æœ€æ–°ç½‘é¡µç»“æ„åˆ†æ

---

## âœ… æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. è‡ªåŠ¨åŒ–æ¨¡å— âœ… **ä¿ç•™**
**åŠŸèƒ½**:
- è‡ªåŠ¨ç‚¹èµ
- è‡ªåŠ¨å…³æ³¨
- è‡ªåŠ¨è½¬å‘
- é€Ÿç‡é™åˆ¶
- åªçœ‹åŸåˆ›è¿‡æ»¤

**ä¼˜åŒ–ç‚¹**:
- âœ… ä½¿ç”¨æœ€æ–°çš„ `data-testid` é€‰æ‹©å™¨
- âœ… è·¨è¯­è¨€å…¼å®¹ï¼ˆä¸ä¾èµ–æ–‡æœ¬åˆ¤æ–­ï¼‰
- âœ… LRU ç¼“å­˜é˜²æ­¢é‡å¤å¤„ç†
- âœ… èŠ‚æµä¼˜åŒ–æ€§èƒ½

**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### 2. åª’ä½“ä¸‹è½½æ¨¡å— âœ… **ä¿ç•™å¹¶ä¼˜åŒ–**

#### 2.1 é«˜æ¸…å›¾ç‰‡åŠŸèƒ½ âš ï¸ **éœ€è¦ç§»é™¤/ç®€åŒ–**
**åŸå› **: X.com ç°åœ¨é»˜è®¤æä¾›é«˜æ¸…å›¾ç‰‡ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ›¿æ¢ URL

**æ—§é€»è¾‘**:
```javascript
// âŒ ä¸å†éœ€è¦
const hdSrc = originalSrc
    .replace(/&name=\w+/, '&name=4096x4096')
    .replace(/\?format=\w+&name=\w+/, '?format=jpg&name=4096x4096');
```

**æ–°æ–¹æ¡ˆ**:
- ç§»é™¤ URL æ›¿æ¢é€»è¾‘
- ä¿ç•™å›¾ç‰‡ä¸‹è½½åŠŸèƒ½
- å¯é€‰ï¼šæ·»åŠ å›¾ç‰‡é¢„è§ˆæ”¾å¤§åŠŸèƒ½

#### 2.2 è§†é¢‘ä¸‹è½½ âœ… **ä¿ç•™**
**åŠŸèƒ½**:
- ä¸‹è½½æœ€é«˜ç ç‡è§†é¢‘
- GIF ä¸‹è½½
- æ‰¹é‡ä¸‹è½½

**ä¼˜åŒ–ç‚¹**:
- âœ… ä½¿ç”¨ `data-testid="videoPlayer"` å®šä½
- âœ… æ·»åŠ ä¸‹è½½è¿›åº¦æç¤º
- âš ï¸ éœ€è¦é€šè¿‡ API è·å–è§†é¢‘ URLï¼ˆåŸé€»è¾‘ä¿ç•™ï¼‰

**å®ç°çŠ¶æ€**: â³ éœ€è¦å®Œå–„

---

### 3. è§†é¢‘æ¨¡å¼ âœ… **ä¿ç•™**
**åŠŸèƒ½**: åªæ˜¾ç¤ºåŒ…å«è§†é¢‘çš„æ¨æ–‡

**ä¼˜åŒ–ç‚¹**:
- âœ… ä½¿ç”¨ `data-testid="videoPlayer"` åˆ¤æ–­
- âœ… ä½¿ç”¨ LRU ç¼“å­˜æå‡æ€§èƒ½
- âœ… åªç›‘å¬ `primaryColumn` å®¹å™¨

**å®ç°çŠ¶æ€**: â³ å¾…å®ç°

---

### 4. é«˜çº§æœç´¢ âœ… **ä¿ç•™**
**åŠŸèƒ½**:
- è‡ªå®šä¹‰æœç´¢æ¡ä»¶
- ä¹¦ç­¾æœç´¢
- é«˜çº§è¿‡æ»¤

**ä¼˜åŒ–ç‚¹**:
- âœ… ä½¿ç”¨ `data-testid="SearchBox_Search_Input"`
- âœ… æ¨¡æ€æ¡† UI ä¼˜åŒ–

**å®ç°çŠ¶æ€**: â³ å¾…å®ç°

---

### 5. ç•Œé¢ä¼˜åŒ– âœ… **ä¿ç•™**
**åŠŸèƒ½**:
- æ¸…çˆ½ç•Œé¢ï¼ˆéšè— Spacesï¼‰
- åªçœ‹åŸåˆ›
- è‡ªå®šä¹‰ä¸»é¢˜

**å®ç°çŠ¶æ€**: â³ å¾…å®ç°

---

## ğŸ”§ ä¼˜åŒ–åçš„åª’ä½“æ¨¡å—

### ç§»é™¤çš„åŠŸèƒ½
```javascript
// âŒ ç§»é™¤ï¼šé«˜æ¸…å›¾ç‰‡ URL æ›¿æ¢
// X.com ç°åœ¨é»˜è®¤æä¾›é«˜æ¸…å›¾ç‰‡
enhanceMediaQuality() {
    // ä¸å†éœ€è¦
}
```

### ä¿ç•™çš„åŠŸèƒ½
```javascript
// âœ… ä¿ç•™ï¼šåª’ä½“ä¸‹è½½
class DownloadModule {
    /**
     * ä¸‹è½½å›¾ç‰‡ï¼ˆç›´æ¥ä½¿ç”¨åŸå§‹ URLï¼‰
     */
    async downloadImages(tweet) {
        const images = Utils.$$(Selectors.tweetPhoto + ' img', tweet);
        for (let i = 0; i < images.length; i++) {
            const img = images[i];
            const url = img.src; // ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦æ›¿æ¢
            const filename = `twitter-image-${Date.now()}-${i}.jpg`;
            await this.download(url, filename);
        }
    }

    /**
     * ä¸‹è½½è§†é¢‘ï¼ˆéœ€è¦é€šè¿‡ API è·å–æœ€é«˜ç ç‡ï¼‰
     */
    async downloadVideo(tweet) {
        // 1. è·å–æ¨æ–‡ ID
        const tweetId = this.getTweetId(tweet);

        // 2. é€šè¿‡ GraphQL API è·å–è§†é¢‘ä¿¡æ¯
        const videoInfo = await this.fetchVideoInfo(tweetId);

        // 3. é€‰æ‹©æœ€é«˜ç ç‡
        const highestQuality = videoInfo.variants
            .filter(v => v.content_type === 'video/mp4')
            .reduce((prev, curr) =>
                (curr.bitrate > prev.bitrate) ? curr : prev
            );

        // 4. ä¸‹è½½
        await this.download(highestQuality.url, `twitter-video-${tweetId}.mp4`);
    }
}
```

---

## ğŸ“Š æœ€æ–° DOM é€‰æ‹©å™¨ï¼ˆ2026-01-19ï¼‰

### æ¨æ–‡å…ƒç´ 
```javascript
const Selectors = {
    // æ¨æ–‡å®¹å™¨
    tweet: 'article[data-testid="tweet"]',
    tweetText: 'div[data-testid="tweetText"]',
    tweetTime: 'article[data-testid="tweet"] time',

    // ç”¨æˆ·ä¿¡æ¯
    userName: 'div[data-testid="User-Name"]',
    userAvatar: 'div[data-testid="Tweet-User-Avatar"]',

    // æ“ä½œæŒ‰é’®ï¼ˆè·¨è¯­è¨€å…¼å®¹ï¼‰
    likeButton: 'button[data-testid="like"]',          // æœªç‚¹èµ
    unlikeButton: 'button[data-testid="unlike"]',      // å·²ç‚¹èµ
    retweetButton: 'button[data-testid="retweet"]',    // æœªè½¬å‘
    unretweetButton: 'button[data-testid="unretweet"]', // å·²è½¬å‘
    replyButton: 'button[data-testid="reply"]',
    bookmarkButton: 'button[data-testid="bookmark"]',
    followButton: 'button[data-testid$="-follow"]',

    // åª’ä½“å…ƒç´ 
    tweetPhoto: 'div[data-testid="tweetPhoto"]',
    videoPlayer: 'div[data-testid="videoPlayer"]',
    videoComponent: 'div[data-testid="videoComponent"]',

    // å®¹å™¨ï¼ˆæ€§èƒ½ä¼˜åŒ–å…³é”®ï¼‰
    primaryColumn: 'div[data-testid="primaryColumn"]',  // ä¸»æ—¶é—´çº¿
    cellInnerDiv: 'div[data-testid="cellInnerDiv"]',    // æ¨æ–‡å•å…ƒ

    // å¯¼èˆª
    searchInput: 'input[data-testid="SearchBox_Search_Input"]',
    homeLink: 'a[data-testid="AppTabBar_Home_Link"]'
};
```

### å…³é”®ä¼˜åŒ–
1. **ä¸ä¾èµ–æ–‡æœ¬å†…å®¹** - ä½¿ç”¨ `data-testid` è€Œä¸æ˜¯ `aria-label` æ–‡æœ¬
2. **æ€§èƒ½ä¼˜åŒ–** - åªç›‘å¬ `primaryColumn`ï¼Œä¸ç›‘å¬æ•´ä¸ª `body`
3. **çŠ¶æ€åˆ¤æ–­** - é€šè¿‡ `data-testid` çš„å€¼åˆ¤æ–­çŠ¶æ€ï¼ˆå¦‚ `like` vs `unlike`ï¼‰

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®ç°ï¼‰
1. âœ… ç§»é™¤é«˜æ¸…å›¾ç‰‡ URL æ›¿æ¢é€»è¾‘
2. â³ å®Œå–„è§†é¢‘ä¸‹è½½ï¼ˆAPI è°ƒç”¨ï¼‰
3. â³ å®ç°è§†é¢‘æ¨¡å¼
4. â³ åˆ›å»º UI æ§åˆ¶é¢æ¿

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®ç°ï¼‰
5. â³ é«˜çº§æœç´¢åŠŸèƒ½
6. â³ ç•Œé¢ä¼˜åŒ–åŠŸèƒ½
7. â³ ç»Ÿè®¡é¢æ¿

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰
8. â³ ä¸»é¢˜åˆ‡æ¢
9. â³ é…ç½®å¯¼å…¥/å¯¼å‡º
10. â³ å¿«æ·é”®æ”¯æŒ

---

## ğŸ’¡ é›†æˆåˆ°ä¸»è„šæœ¬çš„å»ºè®®

### æ–¹æ¡ˆï¼šæ¡ä»¶åŠ è½½
```javascript
// åœ¨ Grok Prompt Manager ä¸»è„šæœ¬ä¸­
class GPM {
    init() {
        // ... ä¸»è„šæœ¬åˆå§‹åŒ– ...

        // æ£€æµ‹æ˜¯å¦åœ¨ Twitter/X
        if (this.isTwitter()) {
            this.loadTwitterModule();
        }
    }

    isTwitter() {
        return window.location.hostname.includes('twitter.com') ||
               window.location.hostname.includes('x.com');
    }

    async loadTwitterModule() {
        // åŠ¨æ€åŠ è½½ Twitter æ¨¡å—
        if (window.TwitterAssistant) {
            window.TwitterAssistant.init({
                integration: {
                    mainScript: this,
                    stateManager: this.storage,
                    uiComponents: this.ui,
                    utils: this.utils
                }
            });

            console.log('[GPM] Twitter æ¨¡å—å·²åŠ è½½');
        }
    }
}
```

### UI é›†æˆ
```javascript
// åœ¨ä¸»è„šæœ¬çš„ä¾§è¾¹æ æ·»åŠ  Twitter æ§åˆ¶
const twitterPanel = `
    <div class="twitter-module" style="
        padding: 12px;
        background: rgba(29, 161, 242, 0.1);
        border-radius: 8px;
        margin-top: 12px;
    ">
        <h4 style="margin: 0 0 8px 0; color: #1DA1F2;">
            ğŸ¦ Twitter åŠ©æ‰‹
        </h4>

        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <button id="twitter-auto-like" class="gpm-btn">
                è‡ªåŠ¨ç‚¹èµ
            </button>
            <button id="twitter-auto-follow" class="gpm-btn">
                è‡ªåŠ¨å…³æ³¨
            </button>
        </div>

        <div style="font-size: 11px; color: #8B98A5;">
            ç‚¹èµ: <span id="twitter-like-count">0</span> |
            å…³æ³¨: <span id="twitter-follow-count">0</span>
        </div>
    </div>
`;
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**:
   - âœ… ç§»é™¤é«˜æ¸…å›¾ç‰‡ URL æ›¿æ¢
   - â³ å®Œå–„è§†é¢‘ä¸‹è½½ API è°ƒç”¨
   - â³ åˆ›å»ºç®€å•çš„ UI æ§åˆ¶é¢æ¿

2. **æµ‹è¯•éªŒè¯**:
   - â³ åœ¨ X.com æµ‹è¯•æ‰€æœ‰é€‰æ‹©å™¨
   - â³ éªŒè¯è‡ªåŠ¨åŒ–åŠŸèƒ½
   - â³ æ€§èƒ½æµ‹è¯•

3. **é›†æˆå‡†å¤‡**:
   - â³ ç¼–å†™é›†æˆæ–‡æ¡£
   - â³ åˆ›å»ºç¤ºä¾‹ä»£ç 
   - â³ å‡†å¤‡æ¼”ç¤º

---

**æ–‡æ¡£ç»“æŸ**
